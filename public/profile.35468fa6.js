import"./FinTrack-main.401b9eb7.js";var e=globalThis,t={},n={},a=e.parcelRequire94c2;null==a&&((a=function(e){if(e in t)return t[e].exports;if(e in n){var a=n[e];delete n[e];var o={id:e,exports:{}};return t[e]=o,a.call(o.exports,o,o.exports),o.exports}var l=Error("Cannot find module '"+e+"'");throw l.code="MODULE_NOT_FOUND",l}).register=function(e,t){n[e]=t},e.parcelRequire94c2=a),a.register;var o=a("gEjZb"),l=a("6AR8M"),c=a("ilpIi");document.addEventListener("DOMContentLoaded",()=>{console.log("%c[DEBUG] profile.js loaded","color: green; font-weight: bold;");let e=document.getElementById("profile-nombre"),t=document.getElementById("profile-apellidos"),n=document.getElementById("profile-email"),a=document.getElementById("link-bank-button"),r=document.getElementById("linked-accounts-message"),s=document.getElementById("linked-accounts-list"),d=!1,u="localhost"===window.location.hostname?"http://localhost:3071":"https://us-central1-fintrack-1bced.cloudfunctions.net/api";async function p(e=null){if(!o.auth.currentUser)return!1;let t={userId:o.auth.currentUser.uid};e&&(t.accessToken=e);try{var n;let e=await fetch(`${u}/plaid/create_link_token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)return!1;let a=await e.json();if(!a.link_token)return!1;return n=a.link_token,i=Plaid.create({token:n,onSuccess:async(e,t)=>{try{let t="localhost"===window.location.hostname?"http://localhost:3071":"https://us-central1-fintrack-1bced.cloudfunctions.net/api",n=await fetch(`${t}/plaid/exchange_public_token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({public_token:e,userId:o.auth.currentUser.uid})});if(n.ok)alert("Cuenta bancaria vinculada con Ã©xito."),location.reload();else{let e=await n.json();alert(`Error al vincular cuenta: ${e.message||"Desconocido"}`)}}catch(e){console.error("[ERROR] onSuccess => exchange_public_token:",e),alert("Error al vincular la cuenta bancaria.")}},onExit:(e,t)=>{},onEvent:(e,t)=>{}}),!0}catch(e){return console.error("[ERROR] fetchAndInitializePlaidLink:",e),!1}}console.log("[DEBUG] apiUrl es:",u),(0,l.onAuthStateChanged)(o.auth,async a=>{if(a&&!d){d=!0;try{let l=await (0,c.getDoc)((0,c.doc)(o.db,"users",a.uid));if(!l.exists())return;let d=l.data();e.textContent=d.firstName||"Sin nombre",t.textContent=d.lastName||"Sin apellidos",n.textContent=a.email||"Sin email";let m=d.plaid?.accounts||[];if(0===m.length){r.style.display="block",r.textContent="No hay cuentas vinculadas actualmente.";return}for(let[e,t]of(r.style.display="none",m.entries()))try{let n=await fetch(`${u}/plaid/get_account_details`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:t.accessToken})}),a=await n.json();if("login_required"===a.status){let t=document.createElement("div");t.classList.add("linked-account"),t.innerHTML=`
              <p><strong>Cuenta ${e+1}</strong></p>
              <p style="color: #c00;">Credenciales caducadas.</p>
              <button class="reauth-btn">Re-autenticar cuenta</button>
            `,t.querySelector(".reauth-btn").addEventListener("click",async()=>{await p(a.accessToken)?i.open():alert("No se pudo iniciar Plaid Link.")}),s.appendChild(t);continue}let o=a.accounts?.[0]||{},l=a.institution||{},c=document.createElement("div");c.classList.add("linked-account"),c.innerHTML=`
            <p><strong>Cuenta ${e+1}</strong></p>
            <p>Banco: ${l.name||"Desconocido"}</p>
            <p>Nombre de la cuenta: ${o.name||"No especificado"}</p>
          `,s.appendChild(c)}catch(t){console.error(`[ERROR] al procesar la cuenta #${e+1}:`,t)}!function(){let e=document.querySelector(".accounts-slider");if(!e)return;let t=e.querySelectorAll(".linked-account"),n=document.getElementById("slider-prev"),a=document.getElementById("slider-next"),o=document.getElementById("slider-dots");if(0===t.length)return;let l=0;function c(n){var a;n<0&&(n=t.length-1),n>=t.length&&(n=0),l=n,e.style.transform=`translateX(-${100*n}%)`,a=n,o.querySelectorAll(".slider-dot").forEach((e,t)=>{e.classList.toggle("active",t===a)})}n&&n.addEventListener("click",()=>c(l-1)),a&&a.addEventListener("click",()=>c(l+1)),o.innerHTML="";for(let e=0;e<t.length;e++){let t=document.createElement("div");t.classList.add("slider-dot"),0===e&&t.classList.add("active"),t.addEventListener("click",()=>c(e)),o.appendChild(t)}c(0)}()}catch(e){console.error("[ERROR] Error general al cargar cuentas:",e)}}}),a&&a.addEventListener("click",async()=>{if(!i&&!await p()){alert("No se pudo iniciar Plaid Link. Revisa la consola.");return}i.open()})});let i=null;
//# sourceMappingURL=profile.35468fa6.js.map

let e,t,o;import"./FinTrack-main.401b9eb7.js";var a=globalThis,n={},r={},s=a.parcelRequire94c2;null==s&&((s=function(e){if(e in n)return n[e].exports;if(e in r){var t=r[e];delete r[e];var o={id:e,exports:{}};return n[e]=o,t.call(o.exports,o,o.exports),o.exports}var a=Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){r[e]=t},a.parcelRequire94c2=s),s.register;var i=s("gEjZb"),l=s("6AR8M"),d=s("ilpIi");console.log("[ANALYSIS] loaded"),document.addEventListener("DOMContentLoaded",()=>{console.log("[ANALYSIS] DOMContentLoaded");let o=document.getElementById("sidebar");document.getElementById("open-sidebar").addEventListener("click",()=>o.classList.add("open")),document.getElementById("close-sidebar").addEventListener("click",()=>o.classList.remove("open")),document.getElementById("logout-link").addEventListener("click",async e=>{e.preventDefault(),await (0,l.signOut)(i.auth),window.location.href="../index.html"}),document.querySelectorAll(".filter-btn").forEach(e=>{e.addEventListener("click",()=>{document.querySelector(".filter-btn.active")?.classList.remove("active"),e.classList.add("active")})}),document.getElementById("period-select").addEventListener("change",e=>{console.log("[ANALYSIS] period change:",e.target.value)}),(0,l.onAuthStateChanged)(i.auth,o=>{if(!o)return window.location.href="../index.html";!function(o){console.log("[ANALYSIS] Start reactiveAnalysis for",o);let a=(0,d.getFirestore)(i.app),n=(0,d.collection)(a,"users",o,"history"),r=(0,d.collection)(a,"users",o,"historySummary");(0,d.collection)(a,"users",o,"historyCategorias");let s=new Set,l=new Map,u=new Map;console.log("[ANALYSIS] initCharts llamado");let g=document.querySelector("#trendChart");g.innerHTML="",(e=new ApexCharts(g,{chart:{type:"line",height:240,toolbar:{show:!1}},series:[],xaxis:{categories:[]},stroke:{curve:"smooth",width:2},grid:{borderColor:"#eee"}})).render();let m=document.querySelector("#barChart");m.innerHTML="",(t=new ApexCharts(m,{chart:{type:"bar",height:200,toolbar:{show:!1}},series:[],xaxis:{categories:[]},plotOptions:{bar:{borderRadius:4}},dataLabels:{enabled:!0,style:{colors:["#fff"]},formatter:e=>e},grid:{borderColor:"#eee"}})).render();let h=document.querySelector("#pieChart");function p(){let n=Array.from(s).sort();console.log("[ANALYSIS] subscribeItems for months",n);let r=0,i=2*n.length,g=()=>{++r>=i&&(console.log("[ANALYSIS] Todos los datos obtenidos. Llamando a renderAnalysis()"),function(){let o=Array.from(s).sort();console.log("[RENDER] Months:",o);let a=o.map(e=>(l.get(e)||[]).reduce((e,t)=>e+(t.amount>0?t.amount:0),0)),n=o.map(e=>(l.get(e)||[]).reduce((e,t)=>e+(t.amount<0?Math.abs(t.amount):0),0)),r=o.map(e=>(l.get(e)||[]).length),i={};o.forEach(e=>{let t=u.get(e)||{};for(let[o,a]of(console.log(`[RENDER] Categor\xedas para ${e}:`,t),Object.entries(t)))i[o]=(i[o]||0)+a});let d=Object.keys(i),g=d.map(e=>+i[e].toFixed(2)),m=d.map(e=>c[e]||"#999");console.log("[RENDER] Pie labels:",d),console.log("[RENDER] Pie data:",g);let h=a.reduce((e,t)=>e+t,0),p=n.reduce((e,t)=>e+t,0);document.getElementById("kpi-revenue").textContent=`\u{20AC}${h.toFixed(2)}`,document.getElementById("kpi-spend").textContent=`\u{20AC}${p.toFixed(2)}`,document.getElementById("kpi-revenue-change").textContent=h&&a.length>1?`+${((a.at(-1)/(h-a.at(-1))-1)*100).toFixed(1)}% vs last`:"+0% vs last",document.getElementById("kpi-spend-change").textContent=p&&n.length>1?`+${((n.at(-1)/(p-n.at(-1))-1)*100).toFixed(1)}% vs last`:"+0% vs last",e.updateOptions({series:[{name:"Ingresos",data:a},{name:"Gastos",data:n}],xaxis:{categories:o}}),t.updateOptions({series:[{name:"Transactions",data:r}],xaxis:{categories:o}});let A=document.querySelector("#pieChart");A.innerHTML="",new ApexCharts(A,{chart:{type:"pie",height:220,animations:{enabled:!1}},series:g,labels:d,colors:m,legend:{position:"bottom"},noData:{text:"Sin datos de categorías",align:"center",verticalAlign:"middle",style:{color:"#999",fontSize:"14px"}}}).render()}())};n.forEach(e=>{let t=(0,d.collection)(a,"users",o,"history",e,"items");(0,d.onSnapshot)(t,t=>{console.log("[ANALYSIS] items change in",e,t.docs.length),l.set(e,t.docs.map(e=>e.data())),g()});let n=(0,d.doc)(a,"users",o,"historyCategorias",e);(0,d.onSnapshot)(n,t=>{if(t.exists()){let o=t.data();delete o.updatedAt,u.set(e,o),console.log(`[ANALYSIS] historyCategorias actualizadas para ${e}:`,o)}else console.log(`[ANALYSIS] No hay historyCategorias para ${e}`);g()})})}h.innerHTML="",new ApexCharts(h,{chart:{type:"pie",height:220,animations:{enabled:!1}},series:[],labels:[],colors:[],legend:{position:"bottom"},noData:{text:"Cargando datos...",align:"center",verticalAlign:"middle",style:{color:"#999",fontSize:"14px"}}}).render(),(0,d.onSnapshot)(n,e=>{e.docs.forEach(e=>s.add(e.id)),console.log("[ANALYSIS] history months updated:",Array.from(s)),p()}),(0,d.onSnapshot)(r,e=>{e.docs.forEach(e=>s.add(e.id)),console.log("[ANALYSIS] summary months updated:",Array.from(s)),p()})}(o.uid)})});let c={"Agricultura y Medio Ambiente":"#A8D5BA","Alimentos y Restauración":"#FFB6B9","Arte y Cultura":"#FFD3B4","Automoción y Transporte":"#C3B1E1","Belleza y Cuidado Personal":"#FFDAC1","Bienes Raíces y Vivienda":"#E2F0CB","Compras y Retail":"#C0E8F9","Deportes y Recreación":"#FFC3A0","Educación y Capacitación":"#B5EAD7","Entretenimiento y Ocio":"#D5AAFF","Eventos y Celebraciones":"#FDCBBA","Finanzas y Seguros":"#D4A5A5","Gobierno y Servicios Públicos":"#AED9E0","Hogar y Jardín":"#FFF5BA","Industrial y Manufactura":"#F1C0E8","Mascotas y Animales":"#B5B9F8",Otros:"#D9D9D9","Religión y Comunidad":"#FFCBC1","Salud y Medicina":"#BEE1E6","Servicios Profesionales":"#E4BAD4","Tecnología e Internet":"#A2D2FF","Viajes y Hostelería":"#FFC9DE","Loan Payments":"#B0BEC5"};
//# sourceMappingURL=analysis.12ebbdf8.js.map

{"mappings":"AAAA,uBAAuB;AAEvB,KAAK,gBAAgB,CAAC,WAAW,CAAC;IAChC,QAAQ,GAAG,CAAC;IACZ,KAAK,WAAW;AAClB;AAEA,KAAK,gBAAgB,CAAC,YAAY,CAAC;IACjC,QAAQ,GAAG,CAAC;IACZ,OAAO,KAAK,OAAO,CAAC,KAAK;AAC3B;AAEA,2BAA2B;AAC3B,KAAK,gBAAgB,CAAC,gBAAgB,CAAC;IACrC,IAAI,MAAM,GAAG,KAAK,qBAAqB;QACrC,QAAQ,GAAG,CAAC;QACZ,MAAM,SAAS,CAAC;IAClB;AACF;AAEA,eAAe;IACb,IAAI;QACF,MAAM,MAAM,MAAM;QAClB,IAAI,CAAC,KAAK;YACR,QAAQ,IAAI,CAAC;YACb;QACF;QAEA,MAAM,SAAS,KAAK,QAAQ,CAAC,QAAQ,KAAK,cACtC,yDACA;QAEJ,MAAM,MAAM,GAAG,OAAO,kCAAkC,CAAC,EAAE;YACzD,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE,QAAQ;YAAI;QACrC;QAEA,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC,8BAA8B;IAC9C;AACF;AAEA,SAAS;IACP,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC3B,MAAM,MAAM,UAAU,IAAI,CAAC,eAAe;QAC1C,IAAI,SAAS,GAAG;YACd,MAAM,KAAK,IAAI,MAAM;YACrB,MAAM,KAAK,GAAG,WAAW,CAAC,YAAY;YACtC,MAAM,QAAQ,GAAG,WAAW,CAAC;YAC7B,MAAM,SAAS,MAAM,GAAG,CAAC;YACzB,OAAO,SAAS,GAAG;gBACjB,QAAQ,OAAO,MAAM,IAAI;gBACzB,GAAG,KAAK;YACV;YACA,OAAO,OAAO,GAAG,IAAM,OAAO,OAAO,KAAK;QAC5C;QACA,IAAI,OAAO,GAAG,IAAM,OAAO,IAAI,KAAK;IACtC;AACF","sources":["js/service-worker.js"],"sourcesContent":["// js/service-worker.js\r\n\r\nself.addEventListener('install', (event) => {\r\n  console.log('[SW] Instalado');\r\n  self.skipWaiting();\r\n});\r\n\r\nself.addEventListener('activate', (event) => {\r\n  console.log('[SW] Activado');\r\n  return self.clients.claim();\r\n});\r\n\r\n// Periodic Background Sync\r\nself.addEventListener('periodicsync', (event) => {\r\n  if (event.tag === 'sync-transactions') {\r\n    console.log('[SW] periodicSync event recibido');\r\n    event.waitUntil(syncTransactionsFromWorker());\r\n  }\r\n});\r\n\r\nasync function syncTransactionsFromWorker() {\r\n  try {\r\n    const uid = await getUIDFromIndexedDB();\r\n    if (!uid) {\r\n      console.warn('[SW] No hay UID para sincronizar');\r\n      return;\r\n    }\r\n\r\n    const apiUrl = self.location.hostname === 'localhost'\r\n      ? 'http://localhost:5001/fintrack-1bced/us-central1/api'\r\n      : 'https://us-central1-fintrack-1bced.cloudfunctions.net/api';\r\n\r\n    await fetch(`${apiUrl}/plaid/sync_transactions_and_store`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ userId: uid })\r\n    });\r\n\r\n    console.log('[SW] Sincronización periódica completada');\r\n  } catch (e) {\r\n    console.error('[SW] Error al sincronizar:', e);\r\n  }\r\n}\r\n\r\nfunction getUIDFromIndexedDB() {\r\n  return new Promise((resolve, reject) => {\r\n    const req = indexedDB.open('fintrack-db', 1);\r\n    req.onsuccess = () => {\r\n      const db = req.result;\r\n      const tx = db.transaction('metadata', 'readonly');\r\n      const store = tx.objectStore('metadata');\r\n      const getReq = store.get('userId');\r\n      getReq.onsuccess = () => {\r\n        resolve(getReq.result || null);\r\n        db.close();\r\n      };\r\n      getReq.onerror = () => reject(getReq.error);\r\n    };\r\n    req.onerror = () => reject(req.error);\r\n  });\r\n}\r\n"],"names":[],"version":3,"file":"service-worker.js.map","sourceRoot":"/__parcel_source_root/"}